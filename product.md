# "赚了吗" App 产品需求文档 (PRD) v1.1

## 一、 产品定位与核心价值
*   **产品名称**：赚了吗 (Zhuanlema)
*   **定位**：轻量级投资交易社交社区（雪球 MVP 简化版）。
*   **核心功能**：打卡互动、行情查看、心得分享、社区评论。
*   **设计风格**：中国红主题，遵循 iOS 现代设计规范，强调简洁与高效。

## 二、 核心功能模块梳理

### 1. 首页：互动与概览
*   **"赚了吗"圆形打卡**：
    *   **交互**：首页中心显著位置，放置一个精致的圆形按钮。
    *   **逻辑**：每日首次进入触发。点击后弹出选择"Yes"或"No"。
    *   **持久化**：打卡结果通过 CloudBase 存储，记录用户每日盈亏状态。
    *   **反馈**：选择后展示今日社区的"赚钱比例"统计（如：今日 60% 的人赚了）。
*   **大盘简报**：
    *   **数据源**：接入腾讯/新浪等公开免费行情 API。
    *   **展示**：展示上证指数、深证成指、创业板指等核心指数的实时数据与涨跌幅。

### 2. 社区：心得与发布
*   **信息流**：以卡片形式展示用户发布的"交易心得"。
*   **发布功能**：
    *   **内容**：支持文字、图片。
    *   **表情包**：内置常用投资相关表情包，增强表达趣味性。
    *   **Tag 标签**：支持添加股票标签或话题标签（如 #贵州茅台#、#今日复盘#）。
*   **互动**：支持点赞、评论、转发。

### 3. 行情：个股信息（无交易）
*   **自选列表**：用户关注的股票列表，支持实时刷新。
*   **个股详情**：
    *   **分时/K线**：接入公开行情 API 展示基础走势图。
    *   **相关讨论**：自动关联该个股的社区评论与心得。

### 4. 账户：登录与个人中心
*   **极简登录**：手机号 + 验证码。
*   **逻辑**：登录即注册。使用 CloudBase Auth 实现身份验证。
*   **个人主页**：展示用户发布的心得、获赞数、累计打卡记录。

## 三、 技术架构与后端集成 (CloudBase)

### 1. 数据库集合 (Collections) 设计
*   **`users`**：存储用户信息（ID、手机号、头像、昵称、注册时间）。
*   **`check_ins`**：存储打卡记录（用户ID、日期、状态 Yes/No）。
*   **`posts`**：存储心得帖子（用户ID、内容、图片URL列表、Tags、表情包标识、发布时间、点赞数）。
*   **`comments`**：存储评论信息（帖子ID、用户ID、内容、发布时间）。
*   **`sms_codes`**：存储短信验证码（手机号、验证码、过期时间、是否已使用）。

### 2. 云开发功能
*   **云函数**：处理行情数据聚合、打卡百分比计算等复杂逻辑。
    - `sendSMSCode`: 发送短信验证码
    - `verifyLoginCode`: 验证登录并创建/获取用户
    - `getTodayCheckInStats`: 获取今日打卡统计
*   **云存储**：存储用户发布的图片。
*   **静态网站托管**：若后续有 H5 页面需求可使用。

### 3. 架构模式
*   **MVVM + Repository**: 适合小型项目，清晰的职责分离。
*   **数据流**: View → ViewModel → Repository → CloudBase Service → CloudBase Backend

## 四、 视觉与交互规范 (UI/UX)

### 1. 颜色主题：中国红
*   **主色调 (Primary)**：`#DC143C` (标准中国红)，用于 Header、主要按钮、圆形打卡按钮、上涨颜色。
*   **辅助色**：
    *   下跌颜色：`#00A650` (绿色)。
    *   背景色：`#F8F8F8` (浅灰)。
*   **文字**：深灰 (#333333) 为主标题，浅灰 (#999999) 为辅助说明。

### 2. 关键交互逻辑
*   **圆形打卡**：采用弹性动画（Spring Animation），点击时有明显的缩放反馈。
*   **发布页**：底部工具栏集成表情包选择器和 Tag 快捷输入。

## 五、 数据来源建议
*   **行情 API**：
    *   腾讯财经 API: `http://qt.gtimg.cn/q=...`
    *   新浪财经 API: `http://hq.sinajs.cn/list=...`

## 六、 MVP 实现范围（当前版本）

### 已实现功能
1. ✅ 手机验证码登录注册
2. ✅ 首页每日打卡（赚了/亏了）
3. ✅ 打卡统计展示
4. ✅ 社区心得列表浏览
5. ✅ 发布心得（文字+标签）
6. ✅ 点赞功能（UI 层面）
7. ✅ 个人中心基础页面
8. ✅ 底部 Tab 导航

### 后续迭代功能
1. 🔄 图片上传到云存储
2. 🔄 评论功能完整实现
3. 🔄 表情包选择器
4. 🔄 大盘指数实时展示
5. 🔄 个股详情页面
6. 🔄 自选股管理
7. 🔄 消息推送
8. 🔄 用户资料编辑

## 七、 技术实现细节

### 登录流程
1. 用户输入手机号
2. 调用 `sendSMSCode` 云函数发送验证码
3. 用户输入验证码
4. 调用 `verifyLoginCode` 云函数验证并创建/获取用户
5. 保存 token 和用户信息到本地
6. 跳转主界面

### 打卡流程
1. 进入首页，检查今日是否已打卡
2. 未打卡：显示红色打卡按钮
3. 点击按钮，弹出选择弹窗
4. 选择"赚了"或"亏了"
5. 提交到 CloudBase check_ins 集合
6. 调用 `getTodayCheckInStats` 更新统计
7. 显示统计结果

### 社区流程
1. 进入社区页面，加载帖子列表
2. 点击发布按钮，打开编辑页面
3. 输入内容和标签
4. 提交到 CloudBase posts 集合
5. 刷新列表展示新帖子

## 八、 数据模型详细设计

### User 用户表
```json
{
  "_id": "用户ID",
  "phoneNumber": "13800138000",
  "nickname": "用户昵称",
  "avatar": "头像URL",
  "createdAt": "2026-01-24T08:00:00.000Z"
}
```

### CheckIn 打卡记录表
```json
{
  "_id": "打卡记录ID",
  "userId": "用户ID",
  "date": "2026-01-24",
  "result": "yes",
  "createdAt": "2026-01-24T08:00:00.000Z"
}
```

### Post 帖子表
```json
{
  "_id": "帖子ID",
  "userId": "用户ID",
  "content": "今天大盘涨了！",
  "images": ["图片URL1", "图片URL2"],
  "tags": ["大盘", "涨停"],
  "likeCount": 42,
  "createdAt": "2026-01-24T08:00:00.000Z"
}
```

### SMSCode 验证码表
```json
{
  "_id": "验证码ID",
  "phoneNumber": "13800138000",
  "code": "123456",
  "expiresAt": "2026-01-24T08:05:00.000Z",
  "used": false,
  "createdAt": "2026-01-24T08:00:00.000Z"
}
```

## 九、 安全与权限

### 数据库权限
- **users**: PRIVATE（用户只能访问自己的数据）
- **check_ins**: PRIVATE（用户只能访问自己的打卡记录）
- **posts**: READONLY（所有人可读，仅创建者可写）
- **sms_codes**: ADMINONLY（仅云函数可访问）

### 数据安全
- Token 存储在 UserDefaults（生产环境应使用 Keychain）
- 验证码 5 分钟过期
- 验证码使用后立即标记为已使用

---

**产品经理**: leacent song  
**文档版本**: v1.1  
**最后更新**: 2026-01-24
